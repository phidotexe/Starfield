<!DOCTYPE html>
<html>
    <head>
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Major+Mono+Display&display=swap" rel="stylesheet">
        <title>StarField</title>
        <style>
            * { margin: 0; padding: 0; }
            html, body { width: 100%; height: 100%; }
            canvas { height: 100%; width: 100%; position: fixed;}
        </style>
    </head>
    <bodyx>
        <canvas id="myCanvas"></canvas>
        <script>
        const NSTARS = 250;
        
        const Star = function(x, y, z) {
            this.x = x;
            this.y = y;
            this.z = z;
            this.size = 25;
        }

        var canvas = document.getElementById("myCanvas");
        var context = canvas.getContext("2d");

        var height = document.documentElement.clientHeight;
        var width = document.documentElement.clientWidth;

        var stars = new Array(); 

        var maxDepth = 7500;

        for(let i = 0; i < NSTARS; i++){
            stars[i] = new Star(Math.random()*width, Math.random()*height, i*(maxDepth/200));
        }
        
        function loop() {
            window.requestAnimationFrame(loop);
            
            height = document.documentElement.clientHeight;
            width = document.documentElement.clientWidth;
            context.canvas.height = height;
            context.canvas.width = width;

            context.fillStyle = "#000000";
            context.fillRect(0, 0, width, height);

            for(let i = stars.length-1; i >= 0; i--){
                let star = stars[i];
                
                //center the generation of the stars
                let t_x = width * 0.5;
                let t_y = height * 0.5;

                //Field of view and stars becoming bigger
                let fov = (height + width) * 0.5;
                let star_x = (star.x - t_x) / (star.z / fov) + t_x;
                let star_y = (star.y - t_y) / (star.z / fov) + t_y;
                let scale = fov/(fov + star.z);  
                star.z -= 5;
                if(star.z < 0) {
                    stars.push(stars.splice(i, 1)[0]);   
                    star.z = maxDepth;
                    continue;
                }
                //color the stars (shades of grey)
                let color = Math.floor(scale * 256);

                //Draw the stars
                context.fillStyle = "rgba(" + color + ", " + color + ", " + color + ", 0.5)";
                context.fillRect(star_x, star_y, star.size*scale, star.size*scale);

                //Testo
                context.font = "2vw 'Major Mono Display', monospace";
                context.fillStyle = "#FFFFFF";
                context.textAlign = "center";
                context.fillText("starfield simulation\n", canvas.width/2, canvas.height/2)
                context.font = "1vw 'Major Mono Display', monospace";
                context.fillText("in pure js", canvas.width/2, (canvas.height/2)+30)
            }

        }

        loop();

        </script>
    </bodyx>
</html>
